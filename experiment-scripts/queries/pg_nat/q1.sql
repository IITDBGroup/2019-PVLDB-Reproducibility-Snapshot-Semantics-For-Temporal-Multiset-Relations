WITH _temp_view_1 AS (
   SELECT l_returnflag AS "l_returnflag", l_linestatus AS "l_linestatus", sum(l_quantity) as "sum_qty", sum(l_extendedprice) as "sum_base_price", sum(l_extendedprice * (1 - l_discount)) as "sum_disc_price", sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as "sum_charge", avg(l_quantity) as "avg_qty", avg(l_extendedprice) as "avg_price", avg(l_discount) as "avg_disc", count(*) as "count_order", ACTIVE_TIME_BEGIN AS "t_b", ACTIVE_TIME_END AS "t_e"
FROM time_lineitem WHERE l_shipdate <= TO_DATE('1998-12-01', 'YYYY-MM-DD') 
GROUP BY PERIOD WITH (ACTIVE_TIME_BEGIN, ACTIVE_TIME_END) l_returnflag, l_linestatus
),
_temp_view_0 AS (
SELECT /*+ materialize */ F0."l_returnflag" AS "l_returnflag", F0."l_linestatus" AS "l_linestatus", F0."sum_qty" AS "sum_qty", F0."sum_base_price" AS "sum_base_price", F0."sum_disc_price" AS "sum_disc_price", F0."sum_charge" AS "sum_charge", F0."avg_qty" AS "avg_qty", F0."avg_price" AS "avg_price", F0."avg_disc" AS "avg_disc", F0."count_order" AS "count_order", F0.DIFFPREVIOUS AS DIFFPREVIOUS, F0."numopen" AS "numopen", F0."t_b" AS "t_b", F0."t_e" AS "t_e"
FROM (
SELECT "l_returnflag" AS "l_returnflag", "l_linestatus" AS "l_linestatus", "sum_qty" AS "sum_qty", "sum_base_price" AS "sum_base_price", "sum_disc_price" AS "sum_disc_price", "sum_charge" AS "sum_charge", "avg_qty" AS "avg_qty", "avg_price" AS "avg_price", "avg_disc" AS "avg_disc", "count_order" AS "count_order", DIFFPREVIOUS AS DIFFPREVIOUS, "numopen" AS "numopen", "ts" AS "t_b", last_value(F0."ts") OVER (PARTITION BY F0."l_returnflag", F0."l_linestatus", F0."sum_qty", F0."sum_base_price", F0."sum_disc_price", F0."sum_charge", F0."avg_qty", F0."avg_price", F0."avg_disc", F0."count_order" ORDER BY F0."ts" ROWS BETWEEN (1) FOLLOWING AND (1) FOLLOWING) AS "t_e"
FROM (
SELECT "l_returnflag" AS "l_returnflag", "l_linestatus" AS "l_linestatus", "sum_qty" AS "sum_qty", "sum_base_price" AS "sum_base_price", "sum_disc_price" AS "sum_disc_price", "sum_charge" AS "sum_charge", "avg_qty" AS "avg_qty", "avg_price" AS "avg_price", "avg_disc" AS "avg_disc", "count_order" AS "count_order", COALESCE(("numopen" - lag(F0."numopen") OVER (PARTITION BY F0."l_returnflag", F0."l_linestatus", F0."sum_qty", F0."sum_base_price", F0."sum_disc_price", F0."sum_charge", F0."avg_qty", F0."avg_price", F0."avg_disc", F0."count_order" ORDER BY F0."ts")), -2000000000) AS DIFFPREVIOUS, "numopen" AS "numopen", "ts" AS "ts"
FROM (
SELECT  DISTINCT "l_returnflag" AS "l_returnflag", "l_linestatus" AS "l_linestatus", "sum_qty" AS "sum_qty", "sum_base_price" AS "sum_base_price", "sum_disc_price" AS "sum_disc_price", "sum_charge" AS "sum_charge", "avg_qty" AS "avg_qty", "avg_price" AS "avg_price", "avg_disc" AS "avg_disc", "count_order" AS "count_order", (sum(F0."t_b") OVER (PARTITION BY F0."l_returnflag", F0."l_linestatus", F0."sum_qty", F0."sum_base_price", F0."sum_disc_price", F0."sum_charge", F0."avg_qty", F0."avg_price", F0."avg_disc", F0."count_order" ORDER BY F0."ts" RANGE UNBOUNDED PRECEDING) - sum(F0."t_e") OVER (PARTITION BY F0."l_returnflag", F0."l_linestatus", F0."sum_qty", F0."sum_base_price", F0."sum_disc_price", F0."sum_charge", F0."avg_qty", F0."avg_price", F0."avg_disc", F0."count_order" ORDER BY F0."ts" RANGE UNBOUNDED PRECEDING)) AS "numopen", "ts" AS "ts"
FROM (
SELECT F0."l_returnflag" AS "l_returnflag", F0."l_linestatus" AS "l_linestatus", F0."sum_qty" AS "sum_qty", F0."sum_base_price" AS "sum_base_price", F0."sum_disc_price" AS "sum_disc_price", F0."sum_charge" AS "sum_charge", F0."avg_qty" AS "avg_qty", F0."avg_price" AS "avg_price", F0."avg_disc" AS "avg_disc", F0."count_order" AS "count_order", 0 AS "t_b", 1 AS "t_e", F0."t_e" AS "ts"
FROM (SELECT * FROM _temp_view_1) F0 UNION ALL
SELECT F0."l_returnflag" AS "l_returnflag", F0."l_linestatus" AS "l_linestatus", F0."sum_qty" AS "sum_qty", F0."sum_base_price" AS "sum_base_price", F0."sum_disc_price" AS "sum_disc_price", F0."sum_charge" AS "sum_charge", F0."avg_qty" AS "avg_qty", F0."avg_price" AS "avg_price", F0."avg_disc" AS "avg_disc", F0."count_order" AS "count_order", 1 AS "t_b", 0 AS "t_e", F0."t_b" AS "ts"
FROM (SELECT * FROM _temp_view_1) F0) F0) F0) F0
WHERE (F0.DIFFPREVIOUS != 0)) F0
WHERE (NOT (((F0."t_e") IS NULL))))
SELECT F0."l_returnflag" AS "l_returnflag", F0."l_linestatus" AS "l_linestatus", F0."sum_qty" AS "sum_qty", F0."sum_base_price" AS "sum_base_price", F0."sum_disc_price" AS "sum_disc_price", F0."sum_charge" AS "sum_charge", F0."avg_qty" AS "avg_qty", F0."avg_price" AS "avg_price", F0."avg_disc" AS "avg_disc", F0."count_order" AS "count_order", F0."t_b" AS "t_b", F0."t_e" AS "t_e"
FROM ((SELECT * FROM _temp_view_0) F0 JOIN generate_series(1,(SELECT MAX(NUMOPEN) FROM (SELECT * FROM _temp_view_0) F0)) F1(n) ON ((F0."numopen" >= F1.N)));